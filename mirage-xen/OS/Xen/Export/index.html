<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Export (mirage-xen.OS.Xen.Export)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../../index.html">mirage-xen</a> &#x00BB; <a href="../../index.html">OS</a> &#x00BB; <a href="../index.html">Xen</a> &#x00BB; Export</nav><h1>Module <code>Xen.Export</code></h1><nav class="toc"><ul><li><a href="#low-level-interface">Low-level interface</a></li></ul></nav></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>When sharing a number of pages with another domain, we receive back both the list of grant references shared and actually mapped page(s). The foreign domain can map the same shared memory, after being notified (e.g. via xenstore) of our domid and list of references.</p></dd></dl><dl><dt class="spec value" id="val-refs"><a href="#val-refs" class="anchor"></a><code><span class="keyword">val</span> refs : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="../Gntref/index.html#type-t">Gntref.t</a> list</span></code></dt><dd><p>The grant references that have been shared with the foreign domain.</p></dd></dl><dl><dt class="spec value" id="val-mapping"><a href="#val-mapping" class="anchor"></a><code><span class="keyword">val</span> mapping : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> Io_page.t</code></dt><dd><p>Mapping of the shared memory.</p></dd></dl><dl><dt class="spec value" id="val-share_pages"><a href="#val-share_pages" class="anchor"></a><code><span class="keyword">val</span> share_pages : <span>domid:int</span> <span>&#45;&gt;</span> <span>count:int</span> <span>&#45;&gt;</span> <span>writable:bool</span> <span>&#45;&gt;</span> <span><span>(<a href="index.html#type-t">t</a>, <span>[&gt; `Grant_table_full ]</span>)</span> Stdlib.result</span></code></dt><dd><p><code>share_pages ~domid ~count ~writable</code> shares <code>count</code> pages with foreign domain <code>domid</code>. <code>writable</code> determines whether or not the foreign domain can write to the shared memory. You must not allow the returned share to be GC'd before successfully calling <code>unshare</code> on it (if you do, the memory and grant ref will be leaked).</p></dd></dl><dl><dt class="spec value" id="val-share_pages_exn"><a href="#val-share_pages_exn" class="anchor"></a><code><span class="keyword">val</span> share_pages_exn : <span>domid:int</span> <span>&#45;&gt;</span> <span>count:int</span> <span>&#45;&gt;</span> <span>writable:bool</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dt class="spec value" id="val-try_unshare"><a href="#val-try_unshare" class="anchor"></a><code><span class="keyword">val</span> try_unshare : <span>release_refs:bool</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span>(unit, <span>[&gt; `Busy ]</span>)</span> Stdlib.result</span></code></dt><dd><p><code>try_unshare ~release_refs t</code> unshares a single mapping (which may involve multiple grants). If <code>release_refs = true</code> then it also calls <code>put</code> on each grant. If it encounters a grant that is still in use then it stops and returns <code>Error `Busy</code>, with <code>t</code> containing the remaining grants. In this case, you must call <code>try_unshare</code> again later to retry.</p></dd></dl><dl><dt class="spec value" id="val-unshare"><a href="#val-unshare" class="anchor"></a><code><span class="keyword">val</span> unshare : <span>release_refs:bool</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p>Like <code>try_unshare</code>, but keeps trying until all pages have been unshared.</p></dd></dl><section><header><h3 id="low-level-interface"><a href="#low-level-interface" class="anchor"></a>Low-level interface</h3></header><dl><dt class="spec value" id="val-get"><a href="#val-get" class="anchor"></a><code><span class="keyword">val</span> get : unit <span>&#45;&gt;</span> <span><a href="../Gntref/index.html#type-t">Gntref.t</a> Lwt.t</span></code></dt><dd><p>Allocate a single grant table index</p></dd></dl><dl><dt class="spec value" id="val-get_n"><a href="#val-get_n" class="anchor"></a><code><span class="keyword">val</span> get_n : int <span>&#45;&gt;</span> <span><span><a href="../Gntref/index.html#type-t">Gntref.t</a> list</span> Lwt.t</span></code></dt><dd><p>Allocate a block of n grant table indices</p></dd></dl><dl><dt class="spec value" id="val-put"><a href="#val-put" class="anchor"></a><code><span class="keyword">val</span> put : <a href="../Gntref/index.html#type-t">Gntref.t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p>Deallocate a grant table index.</p></dd></dl><dl><dt class="spec value" id="val-get_nonblock"><a href="#val-get_nonblock" class="anchor"></a><code><span class="keyword">val</span> get_nonblock : unit <span>&#45;&gt;</span> <span><a href="../Gntref/index.html#type-t">Gntref.t</a> option</span></code></dt><dd><p><code>get_nonblock ()</code> is <code>Some idx</code> if the grant table is not full, or <code>None</code> otherwise.</p></dd></dl><dl><dt class="spec value" id="val-get_n_nonblock"><a href="#val-get_n_nonblock" class="anchor"></a><code><span class="keyword">val</span> get_n_nonblock : int <span>&#45;&gt;</span> <span><a href="../Gntref/index.html#type-t">Gntref.t</a> list</span></code></dt><dd><p><code>get_n_nonblock count</code> is a list of grant table indices of length <code>count</code>, or <code>[]</code> if there if the table is too full to accomodate <code>count</code> new grant references.</p></dd></dl><dl><dt class="spec value" id="val-num_free_grants"><a href="#val-num_free_grants" class="anchor"></a><code><span class="keyword">val</span> num_free_grants : unit <span>&#45;&gt;</span> int</code></dt><dd><p><code>num_free_grants ()</code> returns the number of instantaneously free grant table indices</p></dd></dl><dl><dt class="spec value" id="val-with_ref"><a href="#val-with_ref" class="anchor"></a><code><span class="keyword">val</span> with_ref : <span>(<a href="../Gntref/index.html#type-t">Gntref.t</a> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span></code></dt><dd><p><code>with_ref f</code> allocates a grant with <code>get</code>, passes it to <code>f</code>, and then <code>put</code>s it.</p></dd></dl><dl><dt class="spec value" id="val-with_refs"><a href="#val-with_refs" class="anchor"></a><code><span class="keyword">val</span> with_refs : int <span>&#45;&gt;</span> <span>(<span><a href="../Gntref/index.html#type-t">Gntref.t</a> list</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span></code></dt><dt class="spec value" id="val-grant_access"><a href="#val-grant_access" class="anchor"></a><code><span class="keyword">val</span> grant_access : <span>domid:int</span> <span>&#45;&gt;</span> <span>writable:bool</span> <span>&#45;&gt;</span> <a href="../Gntref/index.html#type-t">Gntref.t</a> <span>&#45;&gt;</span> Io_page.t <span>&#45;&gt;</span> unit</code></dt><dd><p><code>grant_access ~domid ~writable gntref page</code> adds a grant table entry at index <code>gntref</code> to the grant table, granting access to <code>domid</code> to read <code>page</code>, and write to is as well if <code>writable</code> is <code>true</code>. You must call <code>end_access</code> later to unshare the page.</p></dd></dl><dl><dt class="spec value" id="val-try_end_access"><a href="#val-try_end_access" class="anchor"></a><code><span class="keyword">val</span> try_end_access : <span>release_ref:bool</span> <span>&#45;&gt;</span> <a href="../Gntref/index.html#type-t">Gntref.t</a> <span>&#45;&gt;</span> <span><span>(unit, <span>[&gt; `Busy ]</span>)</span> Stdlib.result</span></code></dt><dd><p><code>try_end_access gntref</code> removes entry index <code>gntref</code> from the grant table. If <code>release_ref = true</code> then it also calls <code>put gntref</code> on success. If the remote domain is still using the grant then it returns <code>Error `Busy</code> instead.</p></dd></dl><dl><dt class="spec value" id="val-end_access"><a href="#val-end_access" class="anchor"></a><code><span class="keyword">val</span> end_access : <span>release_ref:bool</span> <span>&#45;&gt;</span> <a href="../Gntref/index.html#type-t">Gntref.t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p>Like <code>try_end_access</code>, but if the remote domain is still using the grant then it sleeps for 10 seconds and tries again, until it succeeds.</p></dd></dl><dl><dt class="spec value" id="val-with_grant"><a href="#val-with_grant" class="anchor"></a><code><span class="keyword">val</span> with_grant : <span>domid:int</span> <span>&#45;&gt;</span> <span>writable:bool</span> <span>&#45;&gt;</span> <a href="../Gntref/index.html#type-t">Gntref.t</a> <span>&#45;&gt;</span> Io_page.t <span>&#45;&gt;</span> <span>(unit <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span></code></dt><dd><p><code>with_grant ~domid ~writable gntref page f</code> shares access to <code>page</code> with <code>domid</code>, calls <code>f ()</code> and then unshares the page.</p></dd></dl><dl><dt class="spec value" id="val-with_grants"><a href="#val-with_grants" class="anchor"></a><code><span class="keyword">val</span> with_grants : <span>domid:int</span> <span>&#45;&gt;</span> <span>writable:bool</span> <span>&#45;&gt;</span> <span><a href="../Gntref/index.html#type-t">Gntref.t</a> list</span> <span>&#45;&gt;</span> <span>Io_page.t list</span> <span>&#45;&gt;</span> <span>(unit <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span></code></dt></dl></section></div></body></html>